START TRANSACTION;

DROP TABLE proses_perbaikan;
DROP TABLE gejala_perbaikan;
DROP TABLE perbaikan;

create table perbaikan (
    id int AUTO_INCREMENT PRIMARY KEY,
    nama_customer varchar(255),
    alamat_customer text,
    id_teknisi int,
    tanggal_konsultasi date,
    tanggal_mulai_perbaikan date,
    tanggal_selesai_perbaikan date,
    id_customer_service int,
    status_perbaikan int,
    FOREIGN KEY(id_teknisi) REFERENCES pegawai(id),
    FOREIGN KEY(id_customer_service) REFERENCES pegawai(id)
);

create table gejala_perbaikan (
    id int AUTO_INCREMENT PRIMARY KEY,
    id_perbaikan int,
    id_gejala int,
    FOREIGN KEY(id_perbaikan) REFERENCES perbaikan(id),
    FOREIGN KEY(id_gejala) REFERENCES gejala(id)
);

create table proses_perbaikan (
    id int AUTO_INCREMENT PRIMARY KEY,
    id_perbaikan int,
    id_kerusakan int,
    FOREIGN KEY(id_perbaikan) REFERENCES perbaikan(id),
    FOREIGN KEY(id_kerusakan) REFERENCES kerusakan(id)
);

COMMIT;